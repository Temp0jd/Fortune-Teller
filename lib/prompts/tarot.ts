export const TAROT_SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä½ä¼ æ‰¿ä¸‰ä»£çš„å¡”ç½—ä¸–å®¶ä¼ äººï¼Œè‡ªå¹¼ç ”ä¹ éŸ¦ç‰¹å¡”ç½—ä½“ç³»ï¼Œæ‹¥æœ‰æ·±åšçš„å¡”ç½—æ™ºæ…§å’Œç›´è§‰åŠ›ã€‚

ä½ çš„å åœé£æ ¼ï¼š
- ç¥ç§˜è€Œä¸æ•…å¼„ç„è™šï¼Œåƒä¸€ä½æ™ºæ…§çš„è€æœ‹å‹
- å–„ç”¨å¡”ç½—çš„æ•…äº‹æ€§ï¼ŒæŠŠç‰Œé¢ä¸²è”æˆäººç”Ÿçš„å¯“è¨€
- æ—¢è§£è¯»ç‰Œé¢çš„è±¡å¾æ„ä¹‰ï¼Œä¹Ÿå€¾å¬ç›´è§‰çš„å£°éŸ³
- å³ä½¿é¢å¯¹"é€†ä½"æˆ–"æŒ‘æˆ˜ç‰Œ"ï¼Œä¹Ÿèƒ½ç»™å‡ºå»ºè®¾æ€§çš„è§†è§’
- è¯­è¨€ä¼˜ç¾æµç•…ï¼Œè®©æ±‚åœè€…æ„Ÿå—åˆ°è¢«ç†è§£å’ŒæŒ‡å¼•

è§£è¯»åŸåˆ™ï¼š
1. æ¯å¼ ç‰Œéƒ½æ˜¯å®‡å®™ç»™ä½ çš„è®¯æ¯ï¼Œæ²¡æœ‰ç»å¯¹çš„å¥½å
2. æ­£ä½ä»£è¡¨èƒ½é‡è‡ªç„¶æµåŠ¨ï¼Œé€†ä½ä»£è¡¨èƒ½é‡å—é˜»æˆ–éœ€è¦å†…çœ
3. ç‰Œé˜µæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œè¦å…³æ³¨ç‰Œä¸ç‰Œä¹‹é—´çš„å¯¹è¯
4. ç»“åˆæ±‚åœè€…çš„å…·ä½“é—®é¢˜ï¼Œç»™å‡ºé’ˆå¯¹æ€§çš„æŒ‡å¼•
5. æœ€åæ€»æ˜¯ä¸€ä¸ªæ¸©æš–æœ‰åŠ›çš„è¡ŒåŠ¨å»ºè®®

è¾“å‡ºç»“æ„ï¼š
ğŸ”® ç‰Œé˜µæ€»è§ˆ
ç®€è¦æè¿°ç‰Œé˜µå‘ˆç°çš„æ•´ä½“èƒ½é‡æ°›å›´

ğŸ“œ é€ç‰Œè§£è¯»
ï¼ˆå¯¹æ¯å¼ ç‰Œï¼‰
ä½ç½®ï¼š[ä½ç½®åç§°]
ç‰Œé¢ï¼š[ç‰Œå] [æ­£ä½/é€†ä½]
ç”»é¢æ„è±¡ï¼šæè¿°ç‰Œé¢ç»™ä½ å¸¦æ¥çš„è§†è§‰æ„Ÿå—å’Œè”æƒ³
æ ¸å¿ƒè®¯æ¯ï¼šè¿™å¼ ç‰Œæƒ³å‘Šè¯‰ä½ ä»€ä¹ˆ
é’ˆå¯¹é—®é¢˜ï¼šç»“åˆæ±‚åœè€…çš„é—®é¢˜ç»™å‡ºå…·ä½“æŒ‡å¼•

ğŸŒŸ ç‰Œé˜µè”åŠ¨
åˆ†æå‡ å¼ ç‰Œä¹‹é—´çš„å…³ç³»å’Œèƒ½é‡æµåŠ¨

ğŸ’« ç»¼åˆæŒ‡å¼•
- æ ¸å¿ƒæ´å¯Ÿï¼šè¿™æ¬¡å åœæœ€å…³é”®çš„ä¿¡æ¯
- è¡ŒåŠ¨å»ºè®®ï¼šå…·ä½“å¯è½åœ°çš„ä¸‹ä¸€æ­¥
- å¿ƒçµå¯„è¯­ï¼šä¸€å¥æ¸©æš–æœ‰åŠ›çš„ç¥ç¦`;

export const TAROT_CARDS = {
  major: [
    { name: 'æ„šè€…', number: 0, meaning: 'æ–°çš„å¼€å§‹ã€å†’é™©ã€çº¯çœŸ', reversed: 'é²è½ã€æ„šè ¢ã€ç¼ºä¹è®¡åˆ’' },
    { name: 'é­”æœ¯å¸ˆ', number: 1, meaning: 'åˆ›é€ åŠ›ã€æ„å¿—åŠ›ã€æ˜¾åŒ–', reversed: 'æ¬ºéª—ã€æ“çºµã€ç¼ºä¹è‡ªä¿¡' },
    { name: 'å¥³ç¥­å¸', number: 2, meaning: 'ç›´è§‰ã€æ½œæ„è¯†ã€ç¥ç§˜', reversed: 'ç§˜å¯†ã€ç–ç¦»ã€å¿½è§†ç›´è§‰' },
    { name: 'çš‡å', number: 3, meaning: 'ä¸°é¥¶ã€æ¯æ€§ã€åˆ›é€ åŠ›', reversed: 'ä¾èµ–ã€è¿‡åº¦ä¿æŠ¤ã€ä¸è‚²' },
    { name: 'çš‡å¸', number: 4, meaning: 'æƒå¨ã€ç»“æ„ã€çˆ¶æ€§', reversed: 'ä¸“åˆ¶ã€åƒµåŒ–ã€æ»¥ç”¨æƒåŠ›' },
    { name: 'æ•™çš‡', number: 5, meaning: 'ä¼ ç»Ÿã€ä¿¡ä»°ã€æ•™è‚²', reversed: 'åå›ã€éä¼ ç»Ÿã€ä¸ªäººä¿¡ä»°' },
    { name: 'æ‹äºº', number: 6, meaning: 'çˆ±æƒ…ã€é€‰æ‹©ã€å’Œè°', reversed: 'å¤±è¡¡ã€é”™è¯¯é€‰æ‹©ã€åˆ†ç¦»' },
    { name: 'æˆ˜è½¦', number: 7, meaning: 'æ„å¿—åŠ›ã€èƒœåˆ©ã€æ§åˆ¶', reversed: 'å¤±æ§ã€å¤±è´¥ã€ç¼ºä¹æ–¹å‘' },
    { name: 'åŠ›é‡', number: 8, meaning: 'å‹‡æ°”ã€è€å¿ƒã€å†…åœ¨åŠ›é‡', reversed: 'è½¯å¼±ã€æ€€ç–‘ã€ç¼ºä¹è‡ªä¿¡' },
    { name: 'éšè€…', number: 9, meaning: 'å†…çœã€ç‹¬å¤„ã€æ™ºæ…§', reversed: 'å­¤ç‹¬ã€å­¤ç«‹ã€æ‹’ç»å»ºè®®' },
    { name: 'å‘½è¿ä¹‹è½®', number: 10, meaning: 'å˜åŒ–ã€å¾ªç¯ã€å‘½è¿', reversed: 'å„è¿ã€é˜»ç¢ã€æŠ—æ‹’å˜åŒ–' },
    { name: 'æ­£ä¹‰', number: 11, meaning: 'å…¬æ­£ã€çœŸç†ã€å› æœ', reversed: 'ä¸å…¬ã€é€ƒé¿è´£ä»»ã€ä¸è¯šå®' },
    { name: 'å€’åŠäºº', number: 12, meaning: 'ç‰ºç‰²ã€ç­‰å¾…ã€æ–°è§†è§’', reversed: 'å›ºæ‰§ã€å¾’åŠ³ã€æŠ—æ‹’æ”¹å˜' },
    { name: 'æ­»ç¥', number: 13, meaning: 'ç»“æŸã€è½¬å˜ã€æ–°ç”Ÿ', reversed: 'åœæ»ã€ææƒ§æ”¹å˜ã€æ‹–å»¶' },
    { name: 'èŠ‚åˆ¶', number: 14, meaning: 'å¹³è¡¡ã€èŠ‚åˆ¶ã€å’Œè°', reversed: 'æç«¯ã€å¤±è¡¡ã€è¿‡åº¦' },
    { name: 'æ¶é­”', number: 15, meaning: 'æŸç¼šã€è¯±æƒ‘ã€ç‰©è´¨ä¸»ä¹‰', reversed: 'è§£æ”¾ã€æŒ£è„±æŸç¼šã€è§‰é†’' },
    { name: 'å¡”', number: 16, meaning: 'çªå˜ã€è§‰é†’ã€ç ´å', reversed: 'é¿å…ç¾éš¾ã€æ¸è¿›æ”¹å˜ã€å¹¸å­˜' },
    { name: 'æ˜Ÿæ˜Ÿ', number: 17, meaning: 'å¸Œæœ›ã€çµæ„Ÿã€å®é™', reversed: 'ç»æœ›ã€ç¼ºä¹ä¿¡å¿ƒã€å¹»ç­' },
    { name: 'æœˆäº®', number: 18, meaning: 'å¹»è§‰ã€ææƒ§ã€æ½œæ„è¯†', reversed: ' clarityã€é‡Šæ”¾ææƒ§ã€çœŸç›¸' },
    { name: 'å¤ªé˜³', number: 19, meaning: 'å¿«ä¹ã€æˆåŠŸã€æ´»åŠ›', reversed: 'æš‚æ—¶çš„é˜´éœ¾ã€è¿‡åº¦è‡ªä¿¡ã€å»¶è¿Ÿçš„å¿«ä¹' },
    { name: 'å®¡åˆ¤', number: 20, meaning: 'é‡ç”Ÿã€è§‰é†’ã€æ•‘èµ', reversed: 'è‡ªè´£ã€æ‹’ç»è§‰é†’ã€å¿½è§†å¬å”¤' },
    { name: 'ä¸–ç•Œ', number: 21, meaning: 'å®Œæˆã€æˆå°±ã€åœ†æ»¡', reversed: 'æœªå®Œæˆã€ç¼ºä¹ closureã€å»¶è¿Ÿ' },
  ],
};

export type TarotSpread = 'single' | 'three' | 'celtic';

export const TAROT_SPREADS = [
  {
    id: 'single' as TarotSpread,
    name: 'å•å¼ ç‰Œ',
    description: 'ä¸€å¼ ç‰Œä»£è¡¨é—®é¢˜çš„æ ¸å¿ƒç­”æ¡ˆ',
    cardCount: 1,
    positions: ['é—®é¢˜æ ¸å¿ƒ'],
  },
  {
    id: 'three' as TarotSpread,
    name: 'ä¸‰å¼ ç‰Œ',
    description: 'è¿‡å»-ç°åœ¨-æœªæ¥çš„æ—¶é—´çº¿è§£è¯»',
    cardCount: 3,
    positions: ['è¿‡å»', 'ç°åœ¨', 'æœªæ¥'],
  },
  {
    id: 'celtic' as TarotSpread,
    name: 'å‡¯å°”ç‰¹åå­—',
    description: 'åå¼ ç‰Œçš„æ·±åº¦è§£è¯»ç‰Œé˜µ',
    cardCount: 10,
    positions: [
      'å½“å‰çŠ¶å†µ',
      'æŒ‘æˆ˜/é˜»ç¢',
      'è¿‡å»åŸºç¡€',
      'è¿‘æœŸè¿‡å»',
      'æœ€å¥½ç»“æœ',
      'è¿‘æœŸæœªæ¥',
      'è‡ªæˆ‘è®¤çŸ¥',
      'ç¯å¢ƒå½±å“',
      'å¸Œæœ›/ææƒ§',
      'æœ€ç»ˆç»“æœ',
    ],
  },
];

export function generateTarotPrompt(
  spread: TarotSpread,
  cards: { name: string; isReversed: boolean; position: number }[],
  question?: string
): string {
  const spreadInfo = TAROT_SPREADS.find((s) => s.id === spread);

  let prompt = `è¯·è§£è¯»${spreadInfo?.name}ç‰Œé˜µã€‚\n\n`;

  if (question) {
    prompt += `âœ¨ æ±‚åœé—®é¢˜ï¼š${question}\n\n`;
  } else {
    prompt += `âœ¨ æ±‚åœé—®é¢˜ï¼šè¯¢é—®å½“ä¸‹æœ€éœ€è¦çŸ¥é“çš„æŒ‡å¼•\n\n`;
  }

  prompt += 'ğŸ´ æŠ½åˆ°çš„ç‰Œï¼š\n';
  cards.forEach((card, index) => {
    const position = spreadInfo?.positions[index] || `ä½ç½® ${index + 1}`;
    const orientation = card.isReversed ? 'é€†ä½ â¬‡ï¸' : 'æ­£ä½ â¬†ï¸';
    prompt += `${index + 1}. ã€${position}ã€‘${card.name} ${orientation}\n`;
  });

  prompt += '\nè¯·ä»¥å¡”ç½—ä¸–å®¶çš„æ™ºæ…§ï¼Œä¸ºæ±‚åœè€…æä¾›æ·±åˆ»è€Œæ¸©æš–çš„è§£è¯»ã€‚';

  return prompt;
}

export function drawCards(count: number): { name: string; isReversed: boolean }[] {
  const cards = [];
  const availableCards = [...TAROT_CARDS.major];

  for (let i = 0; i < count; i++) {
    const randomIndex = Math.floor(Math.random() * availableCards.length);
    const card = availableCards.splice(randomIndex, 1)[0];
    const isReversed = Math.random() < 0.3; // 30% æ¦‚ç‡é€†ä½
    cards.push({
      name: card.name,
      isReversed,
    });
  }

  return cards;
}
